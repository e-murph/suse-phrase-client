= 过滤器
:revdate: 2025-07-10
:page-revdate: {revdate}
:description: SUSE 可观察性

== 概述

通过视图用户界面右上角的 "筛选*器*"菜单，可以筛选视图中显示的组件（拓扑结构）和事件。一旦应用，筛选器将影响视图中所有视角的内容。

image::k8s/k8s-filters.png[查看过滤器]

== 滤波器拓扑结构

拓扑筛选器可用于选择拓扑组件的子集，以便在任何一个可用视角中显示。所有视图类型的事件筛选器都是一样的，而拓扑筛选器则取决于所处的视图类型。更多信息

* xref:/use/views/k8s-filters.adoc#_topology_filters_on_kubernetes_views[Kubernetes 视图上的拓扑过滤器]
* xref:/use/views/k8s-filters.adoc#_topology_filters_on_other_view_types[其他视图类型的拓扑筛选器]

=== Kubernetes 视图上的拓扑过滤器

在xref:/use/views/k8s-views.adoc[kubernetes 视图]中，拓扑过滤器仅限于在所有 Kubernetes 视图中持续存在的一小套基本过滤器：`clusters` 和/或`namespaces` 。Kubernetes 视图的持久拓扑过滤器位于用户界面的常规`filters` 菜单之外，且互不依赖（例如，选择集群*不会*自动更新`namespaces` 过滤器，使其仅反映该集群的命名空间）。

image::k8s/k8s-filters-kube-topology.png[Kubernetes 拓扑过滤器]

=== 其他视图类型的拓扑筛选器

对于其他视图类型，您可以使用基本或高级拓扑过滤器浏览拓扑。了解更多相关信息：

* xref:/use/views/k8s-filters.adoc#_basic_topology_filters[基本拓扑过滤器]
* xref:/use/views/k8s-filters.adoc#_advanced_topology_filters[高级拓扑过滤器]
* xref:/use/views/k8s-filters.adoc#_topology_filtering_limits[拓扑过滤限制]

==== 基本拓扑过滤器

拓扑过滤的主要方法是使用可用的基本过滤器。设置过滤器后，打开的视角会更新，只显示与过滤器匹配的拓扑子集的可视化或数据。设置多个筛选器可进一步缩小搜索范围。您可以为每个过滤器设置多个值，以扩大搜索范围

|===
| 过滤器 | 说明

| 层、域、环境和组件类型
| 根据导入或创建组件时包含的组件详细信息进行筛选。

| 组件健康
| 只包含相关健康检查所报告的具有指定健康状态的组件。

| 组件标签
| 只包含有特定标签的组件。

| 包括组件
| *除了*其他筛选器返回的组件*外*，此处命名的组件也将包含在拓扑中。
|===

要使用基本筛选器筛选拓扑，请单击用户界面右上角的筛选*器*菜单，然后选择*拓扑*垂直选项卡下的*切换到基本*筛选*器*。

image::k8s/k8s-filters-basic-topology.png[基本拓扑过滤器]

==== 高级拓扑过滤器

您可以使用内置的xref:/develop/reference/k8sTs-stql_reference.adoc[SUSE Observability 查询语言 (STQL)]来创建高级拓扑过滤器，放大拓扑的特定区域。

要使用 STQL 查询过滤拓扑，请单击用户界面右上角的 "*过滤器*"菜单，然后选择 "*拓扑*垂直 "选项卡下的 "*切换到 STQL*"。

下面的 STQL 查询示例将返回符合以下条件的组件：

* 在*领域*内 `security check`
* *健康*状态为`Clear` 或 `Deviating`
* 或 是名称*为* `ai_engine`

[,yaml]
----
(domain IN ("security check") AND healthstate IN ("CLEAR", "DEVIATING")) OR name IN ("ai_engine")
----

image::k8s/k8s-filters-advanced-topology.png[高级拓扑过滤器]

==== 基本和高级过滤器的兼容性

您可以在 "*筛选器*"菜单的 "*拓扑*垂直 "选项卡下选择 "*切换到基本*筛选*器*"或 "*切换到 STQL*"，在基本筛选*器*和高级筛选器之间进行切换。

可以随时从基本过滤切换到高级过滤。选定的基本筛选器将直接转换为 STQL 查询。对于简单查询，也可以从高级过滤切换到基本过滤，但有些高级查询与基本过滤不兼容。

➡️xref:/develop/reference/k8sTs-stql_reference.adoc#_compatibility_basic_and_advanced_filters[进一步了解基本拓扑和高级拓扑滤波器的兼容性]

==== 其他过滤器

下面列出的高级筛选器与基本筛选器兼容，但不能作为基本筛选器进行设置或调整。

* xref:/develop/reference/k8sTs-stql_reference.adoc#_withneighborsof[withNeighborsOf]- 当高级筛选器包含xref:/develop/reference/k8sTs-stql_reference.adoc#_withneighborsof[withNeighborsOf] 功能时，*其他筛选器框*中会显示所查询到的邻近组件的数量。为了与基本过滤兼容，必须使用`OR` 运算符将`withNeighborsOf` 函数与其他过滤器连接起来。
* *标识符*- 当高级筛选器按xref:/develop/reference/k8sTs-stql_reference.adoc#_filters[标识符]选择组件时，所查询的组件标识符数量将在 "*其他筛选器*"框中报告。为了与基本过滤兼容，必须指定`identifier` 过滤器，并使用运算符`OR identifier IN (...)` 与其他过滤器连接。

基本拓扑筛选器中的*其他*筛选器框列出了所有这些高级筛选器和受影响组件的数量。

[NOTE]
====
*其他筛选器*"框只显示已设置的高级筛选器的详细信息，这些筛选器与基本筛选器兼容。
====


==== 拓扑过滤限制

为了优化性能，对生成拓扑可视化所能加载的元素数量进行了限制。过滤限制的默认值为 10000 个元素。如果xref:/use/views/k8s-filters.adoc#_basic_topology_filters[基本筛选器]或xref:/use/views/k8s-filters.adoc#_advanced_topology_filters[高级筛选器查询]超出筛选限制，屏幕上将显示一条信息，并且不显示拓扑可视化。

请注意，过滤限制适用于需要*加载*的元素总量，而不是最终显示的元素数量。

在下面的示例中，我们首先加载拓扑中每个组件的所有邻居，然后只显示属于`applications` 层的邻居。由于需要加载拓扑结构中的所有组件，因此很可能会出现过滤限制错误。

[,text]
----
withNeighborsOf(direction = "both", components = (name = "*"), levels = "15")
   AND layer = "applications"
----

要成功制作这种拓扑可视化，我们需要重新编写查询，使加载的组件数量低于配置的过滤限制，或者增加过滤限制。通过只查询`applications` 层中的组件，我们将显示与上述查询相同的组件，而无需首先加载所有组件。因此，这种查询不太可能导致过滤限制错误。

[,yaml]
----
layer = "applications"
----

== 过滤事件

SUSE Observability UI 左侧的 "*视图过滤器*"面板可用于过滤 "xref:/use/views/k8s-events-perspective.adoc[事件视角]"中显示的事件。它们也包含在右侧面板 "*视图摘要*"选项卡和 "详细信息 "选项卡\--"*组件详细信息*"和 "*直接关系详细信息"\--的* *事件*列表中。

可使用以下事件筛选器：

|===
| 过滤器 | 说明

| *类别*
| 只显示一个或多个xref:/use/views/k8s-events-perspective.adoc#_event_category[类别]中的事件。

| *类型*
| 单击 "*类型*"筛选框，打开当前时间窗口中为当前筛选组件生成的所有事件类型的列表。您可以选择一个或多个事件类型来细化显示的事件。

| *资料来源*
| 事件可由 SUSE Observability 生成，或通过集成从 Kubernetes 或 ServiceNow 等外部源系统获取。单击 "*源*过滤框"，打开当前时间窗口中为当前过滤组件生成的事件的所有源系统列表。选择一个或多个源系统，只查看这些事件。

| *标签*
| 从外部系统检索事件时，相关事件属性将作为标签添加。例如`status:open` 或`status:production` 。这有助于确定与特定问题或环境相关的事件。
|===

image::k8s/k8s-filters-events.png[活动筛选器]
