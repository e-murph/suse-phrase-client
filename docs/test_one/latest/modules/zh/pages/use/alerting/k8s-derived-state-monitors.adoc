= 派生状态监测器
:revdate: 2025-07-10
:page-revdate: {revdate}
:description: SUSE 可观察性

== 概述

在可观察性场景中，逻辑（业务）组件缺乏直接监控器，但会受到其技术依赖关系中问题的影响，这时可以使用派生状态监控器功能，从逻辑组件所连接的技术组件中推导出一个状态。
该监控器会遍历组件依赖关系，并根据直接观察结果（如度量指标）选择最关键的健康状态，而忽略任何已衍生的状态。它将把派生状态应用于通过`componentTypes` 参数选择的所有组件。
在遍历过程中，只有具有观测到的（非推导的）健康状态的组件才会被考虑用于健康推导。具有派生状态的组件在评估中会被跳过，但仍会被遍历，以达到更深层次的依赖关系--，例如，逻辑组件依赖于其他逻辑组件。

== 派生健康状态监测器示例

使用`derived-state-monitor` 函数实现的监控器看起来就像这样：

----
  - _type: "Monitor"
    name: "Aggregated health state of a Deployment, StatefulSet, ReplicaSet and DaemonSet"
    tags:
      - deployments
      - replicasets
      - statefulsets
      - daemonsets
      - derived
      - propagated
    identifier: "urn:custom:monitor:..."
    status: "DISABLED"
    description: "Description"
    function: {{ get "urn:stackpack:common:monitor-function:derived-state-monitor" }}
    arguments:
      componentTypes: "deployment, replicaset, statefulset, daemonset"
    intervalSeconds: 30
    remediationHint: "Investigate component [{{ causeComponentName }}](/#/components/{{ causeComponentUrnForUrl }}) as is causing the workload to be unhealthy."
----

* 该函数有一个单一参数`componentTypes` ，您可以将不同的组件类型表示为由`,` 分隔的值组成的单一字符串
* 该功能提供三个值供补救指南使用
 ** `componentName` 是逻辑组件的名称。
 ** `causeComponentName` 是传播状态的组件名称，其`causeComponentUrnForUrl` 可用于创建链接。

xref:/use/alerting/k8s-add-monitors-cli.adoc[使用 CLI 为组件添加阈值监控器的]指南来实施xref:/use/alerting/k8s-add-monitors-cli.adoc[监控器]
